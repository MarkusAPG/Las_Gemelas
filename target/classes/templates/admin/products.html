<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Admin - Productos</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body>
    <header>
        <h1>Admin Panel</h1>
        <nav style="display: flex; align-items: center; gap: 1.5rem;">
            <a th:href="@{/admin/products}" class="admin-nav-link">Productos</a>
            <a th:href="@{/admin/users}" class="admin-nav-link">Usuarios</a>
            <a th:href="@{/admin/tickets}" class="admin-nav-link">Tickets</a>
            <a th:href="@{/admin/reports}" class="admin-nav-link">Reportes</a>
            <!-- User Profile Dropdown -->
            <div class="dropdown">
                <a href="#" style="display: flex; align-items: center; gap: 0.5rem;">
                    <span th:text="${session.usuario.nombre}">Admin</span>
                    <span style="font-size: 0.8rem;">▼</span>
                </a>
                <div class="dropdown-content">
                    <a th:href="@{/logout}">Cerrar Sesión</a>
                </div>
            </div>
        </nav>
    </header>

    <div class="container">
        <!-- Alerts -->
        <div th:if="${success}"
            style="background-color: #dcfce7; color: #166534; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">
            <span th:text="${success}"></span>
        </div>
        <div th:if="${error}"
            style="background-color: #fee2e2; color: #991b1b; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">
            <span th:text="${error}"></span>
        </div>

        <h2>Gestión de Productos</h2>

        <!-- Add Product Form -->
        <div class="form-container" style="max-width: 100%; margin-bottom: 3rem;">
            <h3 style="margin-top: 0; color: var(--primary-color);">Agregar Nuevo Producto</h3>
            <form th:action="@{/admin/products/add}" th:object="${producto}" method="post" enctype="multipart/form-data"
                style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                <div class="form-group">
                    <label>Nombre</label>
                    <input type="text" th:field="*{nombre}" class="form-control" required>
                </div>
                <div class="form-group">
                    <label>Categoría</label>
                    <input type="text" th:field="*{categoria}" class="form-control">
                </div>
                <div class="form-group" style="grid-column: span 2;">
                    <label>Descripción</label>
                    <textarea th:field="*{descripcion}" class="form-control" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label>Tipo</label>
                    <select th:field="*{tipo}" class="form-control">
                        <option value="ambos">Ambos</option>
                        <option value="venta">Venta</option>
                        <option value="alquiler">Alquiler</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Stock Inicial</label>
                    <input type="number" th:field="*{stock}" class="form-control" required>
                </div>
                <div class="form-group">
                    <label>Precio Venta</label>
                    <input type="number" step="0.01" th:field="*{precioVenta}" class="form-control">
                </div>
                <div class="form-group">
                    <label>Precio Alquiler</label>
                    <input type="number" step="0.01" th:field="*{precioAlquiler}" class="form-control">
                </div>
                <div class="form-group" style="grid-column: span 2;">
                    <label>Imagen</label>
                    <input type="file" name="imageFile" class="form-control" accept="image/*">
                </div>
                <div style="grid-column: span 2;">
                    <button type="submit" class="btn btn-primary">Guardar Producto</button>
                </div>
            </form>
        </div>

        <!-- Product List -->
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Imagen</th>
                        <th>Nombre</th>
                        <th>Stock</th>
                        <th>Tipo</th>
                        <th>Venta</th>
                        <th>Alquiler</th>
                        <th>Disponibilidad</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="prod : ${productos}">
                        <td th:text="${prod.id}">1</td>
                        <td>
                            <img th:if="${prod.imagen != null}" th:src="@{'/uploads/' + ${prod.imagen}}"
                                style="width: 50px; height: 50px; object-fit: cover;">
                            <span th:if="${prod.imagen == null}">No img</span>
                        </td>
                        <td th:text="${prod.nombre}">Producto</td>
                        <td>
                            <form th:action="@{/admin/products/updateStock}" method="post"
                                style="display: flex; gap: 0.5rem;">
                                <input type="hidden" name="id" th:value="${prod.id}">
                                <input type="number" name="stock" th:value="${prod.stock}"
                                    style="width: 60px; padding: 0.2rem;" class="form-control">
                                <button type="submit" class="btn btn-primary"
                                    style="padding: 0.2rem 0.5rem; font-size: 0.8rem;">✓</button>
                            </form>
                        </td>
                        <td th:text="${prod.tipo}">Venta</td>
                        <td th:text="${prod.precioVenta}">0.00</td>
                        <td th:text="${prod.precioAlquiler}">0.00</td>
                        <td>
                            <a th:href="@{/admin/products/toggle/{id}(id=${prod.id})}" class="btn"
                                th:style="${prod.estado == 'disponible' ? 'background-color: #ef4444; color: white;' : 'background-color: #22c55e; color: white;'}"
                                th:text="${prod.estado == 'disponible' ? 'Desactivar' : 'Activar'}"
                                style="padding: 0.2rem 0.5rem; font-size: 0.8rem; margin-right: 0.5rem;">
                                Toggle
                            </a>
                            <a th:href="@{/admin/products/delete/{id}(id=${prod.id})}" class="btn"
                                style="background-color: #ef4444; color: white; padding: 0.2rem 0.5rem; font-size: 0.8rem;"
                                onclick="return confirm('¿Estás seguro de eliminar este producto?')">Eliminar</a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</body>

</html>